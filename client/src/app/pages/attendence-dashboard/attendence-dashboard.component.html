

<div class="app-main">
           
    <div class="app-main__outer">
        <div class="app-main__inner">
                 
            
            <div class="row">
                <div class="col-md-6 col-xl-4">
                    <div class="card mb-3 widget-content bg-midnight-bloom">
                        <div class="widget-content-wrapper text-white">
                            <div class="widget-content-left">
                                <div class="widget-heading">Total Present </div>
                                <!-- <div class="widget-subheading">Last year expenses</div> -->
                            </div>
                            <div class="widget-content-right">
                                <div class="widget-numbers text-white"><span>{{monthDetails?.Present}}</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-4">
                    <div class="card mb-3 widget-content bg-arielle-smile">
                        <div class="widget-content-wrapper text-white">
                            <div class="widget-content-left">
                                <div class="widget-heading">Total Absent</div>
                                <!-- <div class="widget-subheading">Total Clients Profit</div> -->
                            </div>
                            <div class="widget-content-right">
                                <div class="widget-numbers text-white"><span>{{monthDetails?.absent}}</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-4">
                    <div class="card mb-3 widget-content bg-grow-early">
                        <div class="widget-content-wrapper text-white">
                            <div class="widget-content-left">
                                <div class="widget-heading">No Of Days</div>
                                <!-- <div class="widget-subheading">People Interested</div> -->
                            </div>
                            <div class="widget-content-right">
                                <div class="widget-numbers text-white"><span>{{monthDetails?.noOfDay}}</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- <div class="d-xl-none d-lg-block col-md-6 col-xl-4">
                    <div class="card mb-3 widget-content bg-premium-dark">
                        <div class="widget-content-wrapper text-white">
                            <div class="widget-content-left">
                                <div class="widget-heading">Products Sold</div>
                                <div class="widget-subheading">Revenue streams</div>
                            </div>
                            <div class="widget-content-right">
                                <div class="widget-numbers text-warning"><span>$14M</span></div>
                            </div>
                        </div>
                    </div>
                </div> -->
            </div>
            <div class="row">
                <div class="col-md-12 col-lg-6">
                    <div class="mb-3 card">
                        <div class="card-header-tab card-header-tab-animation card-header">
                            <div class="card-header-title">
                                <i class="header-icon lnr-apartment icon-gradient bg-love-kiss"> </i>
                               {{monthName[monthIndex]}}
                            </div>
                            <ul class="nav">
                                <li class="nav-item"><a href="javascript:void(0);" class=" nav-link">{{employeeData?.fullName
                                }} </a></li>
                                <!-- <li class="nav-item"><a href="javascript:void(0);" class="nav-link second-tab-toggle">({{employeeData?.designation}})</a></li> -->
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="tabs-eg-77">
                                    <div class="card mb-3 widget-chart widget-chart2 text-left w-100">
                                        <div class="widget-chat-wrapper-outer">
                                            <div class="widget-chart-wrapper widget-chart-wrapper-lg opacity-10 m-0">
                                                <app-chart [lineChartType]="'doughnut'" [lineChartData]="lineChart" [lineChartLabels]="chartLabel"></app-chart>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    <h6 class="text-muted text-uppercase font-size-md opacity-5 font-weight-normal">Present Status</h6>
                                    <div class="scroll-area-sm">
                                        <div class="scrollbar-container">
                                            <div class="container table scroll">
                                                <table class="dashboard-rwd-table" id="mobile-table">
                                                  <tbody>
                                                    <tr>
                                                      <th>Site Name</th>
                                                      <th>Location</th>
                                                      <th>Date</th>
                                                      <th>Status</th>
                                                      <th>Action</th>
                                                    
                                                    </tr>
                                                    <tr *ngFor="let item of currentMonthAtt">
                                                      <td data-th="Site Name">
                                                        {{item?.siteName | titlecase}}
                                                      </td>
                                                      <td data-th="Location">
                                                        {{item?.location | titlecase}}
                                                      </td>
                                                      <td data-th="Date">
                                                        {{item?.date | date}}
                                                      </td>
                                                      <td data-th="Status">
                                                        <div *ngIf="item.status === 'Present' ">
                                                            <button class="pillbutton green">Present</button>
                                                        </div>
                                                        <div *ngIf="item.status === 'Absent'">
                                                            <button class="pillbutton red">Absent</button>
                                                        </div>
                                                      </td>
                                                      <td data-th="Action">
                                                        <div *ngIf="item.approvalStatus === 'Not-Approved' ">
                                                            <i  style="font-size: 18px;color: red;"  (click)="approvedEvent('Approve',item)" class="fa fa-times-circle-o" aria-hidden="true"></i>
                                                        </div>
                                                        <div *ngIf="item.approvalStatus === 'Approved'">
                                                            <i  style="font-size: 18px;color: green;" (click)="approvedEvent('Reject',item)"  class="fa fa-check-circle" aria-hidden="true"></i>
                                                        </div>
                                                      </td>                               
                                                     
                                                    </tr>
                                                   
                                                  </tbody>
                                               
                                                </table>
                                                
                                              </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 col-lg-6">
                    <div class="mb-3 card">
                        <div class="card-header-tab card-header">
                            <div class="card-header-title">
                                <i class="header-icon lnr-rocket icon-gradient bg-tempting-azure"> </i>
                                Yearly Attendence Reports
                            </div>
                        
                        </div>

                        <div class="card-body">
                          <div class="tab-content">
                              <div class="tab-pane fade show active" id="tabs-eg-77">
                                  <div class="card mb-3 widget-chart widget-chart2 text-left w-100">
                                      <div class="widget-chat-wrapper-outer">
                                          <div class="widget-chart-wrapper widget-chart-wrapper-lg opacity-10 m-0">
                                            <div>
                                              <app-chart [lineChartType]="'line'" [lineChartData]="lineChart1" [lineChartLabels]="chartLabel1"></app-chart>
                                                      
                                          </div>
                                              
                                          </div>
                                      </div>
                                  </div>
                                  <h6 class="text-muted text-uppercase font-size-md opacity-5 font-weight-normal">Absent Status</h6>
                                  <div class="scroll-area-sm">
                                      <div class="scrollbar-container">
                                          <div class="container table scroll">
                                            <table class="dashboard-rwd-table" id="mobile-table">
                                              <tbody>
                                                <tr>
                                                  <th>Site Name</th>
                                                  <th>Location</th>
                                                  <th>Start Date</th>
                                                  <th>End Date</th>
                                                  <th>Status</th>
                                                  <th>Action</th>
                                                
                                                </tr>
                                                <tr *ngFor="let item of currentMonthAbscent">
                                                  <td data-th="Site Name">
                                                    {{item?.siteName | titlecase}}
                                                  </td>
                                                  <td data-th="Location">
                                                    {{item?.location | titlecase}}
                                                  </td>
                                                  <td data-th="Date">
                                                    {{item?.start | date}}
                                                  </td>
                                                  <td data-th="Date">
                                                    {{item?.end | date}}
                                                  </td>
                                                  <td data-th="Status">
                                                    <div *ngIf="item.status === 'Present' ">
                                                        <button class="pillbutton green">Present</button>
                                                    </div>
                                                    <div *ngIf="item.status === 'Absent'">
                                                        <button class="pillbutton red">Absent</button>
                                                    </div>
                                                  </td>
                                                  <td data-th="Action">
                                                    <div *ngIf="item.approvalStatus === 'Not-Approved' ">
                                                        <i  style="font-size: 18px;color: red;"  (click)="approvedEvent('Approve',item)" class="fa fa-times-circle-o" aria-hidden="true"></i>
                                                    </div>
                                                    <div *ngIf="item.approvalStatus === 'Approved'">
                                                        <i  style="font-size: 18px;color: green;" (click)="approvedEvent('Reject',item)"  class="fa fa-check-circle" aria-hidden="true"></i>
                                                    </div>
                                                  </td>                               
                                                 
                                                </tr>
                                               
                                              </tbody>
                                           
                                            </table>
                                              
                                            </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 col-xl-4">
                    <div class="card mb-3 widget-content">
                        <div class="widget-content-outer">
                            <div class="widget-content-wrapper">
                                <div class="widget-content-left">
                                    <div class="widget-heading">Generate Payslip</div>
                                    <div class="widget-subheading"> 
                                        <select  (change)="monthChange($event)" >
                                        <option value="" selected disable>Month</option>
                                        <option  *ngFor="let item of month"  [value]= "item.id" >{{item.name}}</option>
                                      </select></div>
                                </div>
                               
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="main-card mb-3 card">
                        <div class="card-header">Active Users
                            <div class="btn-actions-pane-right">
                                <div role="group" class="btn-group-sm btn-group">
                                    <select  class="active btn btn-focus" (change)="monthChange($event)" >
                                        <option value="" selected disable>Month</option>
                                        <option  *ngFor="let item of month"  [value]= "item.id" >{{item.name}}</option>
                                      </select>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="dashboard-rwd-table" id="mobile-table">
                                <tbody>
                                  <tr>
                                    <th>Site Name</th>
                                    <th>Location</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                  
                                  </tr>
                                  <tr *ngFor="let item of allData">
                                    <td data-th="Site Name">
                                      {{item?.siteName | titlecase}}
                                    </td>
                                    <td data-th="Location">
                                      {{item?.location | titlecase}}
                                    </td>
                                    <td data-th="Date" *ngIf="item?.date">
                                      {{item?.date | date}}
                                    </td>
                                    <td data-th="Date" *ngIf="!item?.date">
                                      {{item?.start | date}} -  {{item?.end | date}}
                                    </td>
                                    <td data-th="Status">
                                      <div *ngIf="item.status === 'Present' ">
                                          <button class="pillbutton green">Present</button>
                                      </div>
                                      <div *ngIf="item.status === 'Absent'">
                                          <button class="pillbutton red">Absent</button>
                                      </div>
                                    </td>
                                    <td data-th="Action">
                                      <div *ngIf="item.approvalStatus === 'Not-Approved' ">
                                          <i  style="font-size: 18px;color: red;" (click)="approvedEvent('Approve',item)" class="fa fa-times-circle-o" aria-hidden="true"></i>
                                      </div>
                                      <div *ngIf="item.approvalStatus === 'Approved'">
                                          <i  style="font-size: 18px;color: green;" (click)="approvedEvent('Reject',item)" class="fa fa-check-circle" aria-hidden="true"></i>
                                      </div>
                                    </td>                               
                                   
                                  </tr>
                                 
                                </tbody>
                             
                              </table>
                        </div>
                       
                    </div>
                </div>
            </div>
            
        </div>
          </div>
    <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
</div>

<ng-template  #approvalAttendence let-data let-ref="dialogRef">
    <nb-card  style="width:500px">
      <nb-card-header>User Status</nb-card-header>
      <nb-card-body>
       Are You Sure You Want To {{approvalType}} This User?
      </nb-card-body>
      <nb-card-footer>
        <button nbButton status="success" *ngIf= "approvalType == 'Approve'" (click)="submitApproval('Approved')">Approved</button> 
        <button nbButton status="warning"  *ngIf= "approvalType == 'Reject'" (click)="submitApproval('Reject')">Rejected</button>
        &nbsp; &nbsp;<button nbButton status="basic" (click)="ref.close()">Cancel</button>
      </nb-card-footer>
    </nb-card>
  </ng-template>

 <ng-template #payslipValue let-data let-ref="dialogRef">
    <nb-card  >
      <nb-card-body>
      <div class="salary-slip" id="salarySlip" >
        <table class="empDetail">
          <tr height="100px" style='background-color: #a5d8ff'>
            <td colspan='4'>
              <img height="90px" src='assets/image/logo.png' /></td>
            <td colspan='4' class="companyName">Aayat Construction</td>
          </tr>
          <tr>
            <th>
            Employee Id:
    </th>
            <td>
            {{employeeData?._id}}
    </td>
            <td></td>
         
            <td></td>
            <th>
              Employee Name:
    </th>
            <td>
              {{employeeData?.fullName}}
    </td>
          </tr>
          <tr>
            <th>
            Location:
    </th>
            <td>
              {{employeeData?.address}}
    </td>
    <td></td>
         
    <td></td>    
    <th>
        Date:
    </th>
        <td>
          {{currentDate | date:'yyyy-MM-dd'}}
    </td>
        
       
          </tr>
          <tr>
            <th>
             Designation:
    </th>
            <td>
              {{employeeData?.designation}}
    </td><td></td>
          <td></td>
            <th>
              IFSC Code:
    </th>
            <td>
              {{employeeData?.ifsccode}}   
    </td>
          </tr>
          <tr>
            <th>
             Bank Name:
    </th>
            <td>
              {{employeeData?.bankName}}
    </td><td></td>
       <td></td>
            <th>
            Bank A\C No:
    </th>
            <td>
              xxxx-xxxx-xxxx-{{employeeData?.accNo | slice:-4}}
    </td>
          </tr>
          <tr>
            <th>
             Adhar No:
    </th>
            <td>
              {{employeeData?.adharNo}}
    </td><td></td>
     <td></td>
            <th>
              PAN No:
    </th>
            <td>
              
    </td>
          </tr>
          <tr class="myBackground">
            <th colspan="2">
              Payments
    </th>
            <th >
              Particular
    </th>
            <th class="table-border-right">
              Amount (Rs.)
    </th>
            <th colspan="2">
              Deductions
    </th>
            <th >
              Particular
    </th>
            <th >
              Amount (Rs.)
    </th>
          </tr>
          <tr>
            <th colspan="2">
              Basic Salary
    </th>
            <td></td>
            <td class="myAlign">
              {{employeeData?.basicPay}}
    </td>
            <th colspan="2" >
              Provident Fund
    </th >
            <td></td>
    
            <td class="myAlign">
              00.00
    </td>
          </tr >
          <tr>
            <th colspan="2">
            HRA
    </th>
            <td></td>
    
            <td class="myAlign">
              00.00
    </td>
            <th colspan="2" >
              LWP
    </th >
            <td></td>
    
            <td class="myAlign">
             {{totalpayment?.LWP}}
    </td>
          </tr >
          <tr>
            <th colspan="2">
              Special Allowance
    </th>
            <td></td>
    
            <td class="myAlign">
              00.00
    </td>
            <th colspan="2" >
             
    </th >
            <td></td>
    
            <td class="myAlign">
              
    </td>
          </tr >
          <tr>
        
            <td></td>
            
          </tr >
     
         
          <tr class="myBackground">
            <th colspan="3">
              Total Payments
    </th>
            <td class="myAlign">
              {{totalpayment.totalPayment}}
    </td>
            <th colspan="3" >
              Total Deductions
    </th >
            <td class="myAlign">
              {{totalpayment.LWP}}
    </td>
          </tr >
          <tr height="40px">
            <th colspan="2">
              Projection for Financial Year:
            </th>
            <th>
            </th>
            <td class="table-border-right">
            </td>
            <th colspan="2" class="table-border-bottom" >
              Net Salary
            </th >
            <td >
            </td>
            <td >
            {{totalpayment.netSalary}}
            </td>
          </tr >
          <tr>
            <td colspan="2">
              Gross Salary
            </td> <td></td>
            <td class="myAlign">
              00.00
    </td><td colspan="4"></td>
          </tr >
          <tr>
            <td colspan="2">
              Aggr. Dedu - P.Tax & Std Ded
    </td> <td></td>
            <td class="myAlign">
              00.00
    </td>
            <th colspan="2" >
              Cumulative
    </th >
            <td colspan="2"></td>
          </tr >
          <tr>
            <td colspan="2">
              Gross Total Income
    </td> <td></td>
            <td class="myAlign">
              00.00
    </td>
            <td colspan="2" >
              Empl PF Contribution
    </td > <td></td>
            <td class="myAlign">
              00.00
    </td>
          </tr >
   
          <tr>
            <td colspan="2">
              Total Income
    </td> <td></td>
            <td class="myAlign">
              00.00
    </td>
            <td colspan="4"></td>
          </tr >
          <tbody class="border-center">
            <tr>
              <th>
                Attend/ Absence
    </th>
              <th>
                Days in Month
    </th>
              <th>
                Days Paid
    </th>
              <th>
                Days Not Paid
    </th>
              <th>
                Leave Position
    </th>
              <th>
                Privilege Leave
    </th>
              <th>
                Sick Leave
    </th>
              <th>
                Casual Leave
    </th>
            </tr>
            <tr>
              <td ></td>
              <td ></td>
              <td ></td>
              <td ></td>
              <td>Yrly Open Balance</td>
              <td>0.0</td> <td>0.0</td>
              <td>0.0</td>
            </tr >
            <tr>
              <th >Current Month</th>
              <td>{{aatendecneObj.noOfDay}}</td>
              <td >{{aatendecneObj.present}}</td>
              <td >{{aatendecneObj.abscent}}</td>
              <td>Availed</td>
              <td>0.0</td> <td>0.0</td>
              <td>0.0</td>
            </tr >
          
            <tr>
              <td colspan="4"> &nbsp; </td>
              <td > </td>
              <td > </td>
              <td > </td>
              <td > </td>
            </tr >
          
          </tbody>
        </table >
    
      </div >
    </nb-card-body>
      <nb-card-footer>
        <button nbButton status="basic" (click)="ref.close()">Cancel</button>
      </nb-card-footer>
    </nb-card>
  </ng-template>