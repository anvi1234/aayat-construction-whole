


  <app-loader></app-loader>
  <ng-template #dialogdelete let-data let-ref="dialogRef">
    <nb-card  style="width:500px">
      <nb-card-header>Delete Expense</nb-card-header>
      <nb-card-body>
       Are You Sure You Want To Delete This Expenses?
      </nb-card-body>
      <nb-card-footer>
        <button nbButton status="warning" (click)="removeExpense()">Delete</button>&nbsp; &nbsp;<button nbButton status="basic" (click)="ref.close()">Cancel</button>
      </nb-card-footer>
    </nb-card>
  </ng-template>
  
 

    <nb-card>
      <nb-card-header><span class="card-heading">
        Site Expenses 
     </span><button class="header-button" (click)="gotoAddExpenses()" nbButton status="primary"><span class="add-icon">+</span></button> </nb-card-header>
      <nb-card-body>
        <nb-tabset fullWidth (changeTab)="fetchNews($event)">
          <nb-tab tabTitle="Daily Expenses" active="true">
            <div id="htmlDataDE">
               <h4 style="text-align: center;color:rgb(23, 23, 96)">{{siteNameValueheader}}-{{siteLocationNameheader}} Daily Expenses</h4>
               <div class="transactHeading">Total Transaction On Site : <b>{{transactionobj?.dailyExpense  | currency:'INR'}}</b></div>
            <div *ngFor ="let item of  amountAfterChange;index as i" >
              <div class="row">
                <div class="col-sm-12">
                  <span class="duration-class"><b>Duration:</b>&nbsp;{{item.date|date}}&nbsp;&nbsp; <i style="font-size:18px" (click) = "updateCalednder($event,i)" *ngIf="calenderHide" class="fa">&#xf073;</i> &nbsp;&nbsp;&nbsp;<input type="date" *ngIf="!calenderHide && enableCalenderIndex == i" [(ngModel)]="calender" (change)="handler(item)"> &nbsp; &nbsp; &nbsp;<span><i *ngIf="!calenderHide && enableCalenderIndex == i" style="color:red;" (click)="cancelCalender()" class="fa fa-close" ></i></span> </span>
                </div>
                <div class="col-sm-12">
                  <span class="duration-class"><b>SuperVisor : </b>{{item.superVisorName}}</span>
           
                </div>
              </div>
              <div class="expenses-grid">
                <table>
                  <tr>
                    <th>Total Expenses:</th>
                    <th>Recieving Amount:</th>
                    <th>Site Amount:</th>
                  </tr>
                  <tr>
                    <td>{{item.expenseAmount | currency:'INR'}}</td>
                    <td>{{item.totalAmount | currency:'INR'}}</td>
                    <td [ngStyle]="checkValueSIgn(item.siteAmount) == -1 ?{'background-color': 'rgb(232, 127, 127)'} : {'background-color': '#e6edac'}">  {{item.siteAmount | currency:'INR'}}</td>
                  </tr>
                  </table>
              </div>
           
             <br>
              <span class="action-icon">
           <a class="table-row-action edit-action" *ngIf="!editData " (click)="enableEditMethod($event,i)">
              <i class="fa fa-pencil" uib-tooltip="Edit" tooltip-trigger="mouseenter" tooltip-append-to-body="true" tooltip-placement="left"></i>
             </a>  &nbsp;   &nbsp;   &nbsp;
            <a *ngIf="!editData " (click)="delete(item)"><i class="fa fa-trash" uib-tooltip="delete" style="color:red;" tooltip-trigger="mouseenter" tooltip-append-to-body="true" tooltip-placement="left"></i></a>
            <i *ngIf="editData && enableEditIndex == i" style="color:red;" (click)="editData=false" class="fa fa-close" ng-click="cancel()"></i>
         &nbsp;   &nbsp;   &nbsp;   <i *ngIf="editData && enableEditIndex == i" style="color:green;" id="saveBtn" class="fa fa-check"  (click) = "saveData(item)" type="submit"></i>
          </span><br>
          <div class="row">
            <div class="col-sm-12 table ">
              <table id="customers">
                <tr>
                  <th id="product">Product Item</th>
                  <th id="amt">Amount</th>
                  <th id="quant">Quantity</th>
     
                </tr>
                <tr *ngFor ="let data of item.expenses;let f = index">
                  <td class="itemclass"><input type="text" [(ngModel)]="data.productItem"  [disabled]="!editData"></td>
                  <td > <input type="number" [(ngModel)]="data.amount" (blur)="onBlurEvent(item,i)" [disabled]="!editData"></td>
                  <td class="quantityclass"><input type="text" [(ngModel)]="data.quantity"  [disabled]="!editData"></td>
                  <!-- <span class="remove-icon-grid" (click)="removeRow(f,item)">
                    <i class="fa fa-minus" aria-hidden="true"></i></span> -->
                  </tr> 
        
               
              </table>
            </div>
           
            </div>
            <div class="botom-icon"> <span (click)="addRow(i,item)"><i class="fa fa-plus" aria-hidden="true"></i></span></div>
            <!-- &nbsp;&nbsp;&nbsp;<span (click)=" remove(i,item)"><i class="fa fa-minus" aria-hidden="true"></i></span> -->
         
            <br></div>
          </div>
          </nb-tab>
          <nb-tab  tabTitle="Material On Site">
           
             <div id="htmlDataMOS">
              <h4 style="text-align: center;color:rgb(23, 23, 96)">{{siteNameValueheader}}-{{siteLocationNameheader}} Material On Site</h4>
              <div class="transactHeading">Total Transaction On Site :<b>{{transactionobj?.MOSExpense | currency:'INR'}}</b></div>
              <div *ngFor ="let item of amountAfterChange;index as i" >
                
                <div class="row">
                  <div class="col-sm-12">
                    <span class="duration-class"><b>Duration:</b>&nbsp;{{item.date|date}}&nbsp;&nbsp; <i style="font-size:18px" (click) = "updateCalednder($event,i)" *ngIf="calenderHide" class="fa">&#xf073;</i> &nbsp;&nbsp;&nbsp;<input type="date" *ngIf="!calenderHide && enableCalenderIndex == i" [(ngModel)]="calender" (change)="handler(item)"> &nbsp;<span><i *ngIf="!calenderHide && enableCalenderIndex == i" style="color:red;" (click)="cancelCalender()" class="fa fa-close" ></i></span> </span>
                  </div>
                  <div class="col-sm-12">
                    <span class="duration-class"><b>SuperVisor : </b>{{item.superVisorName}}</span>
             
                  </div>
                </div>
                <div class="expenses-grid">
                  <table>
                    <tr>
                      <th>Total Expenses:</th>
                      <th>Recieving Amount:</th>
                      <th>Site Amount:</th>
                    </tr>
                    <tr>
                      <td>{{item.expenseAmount | currency:'INR'}}</td>
                      <td>{{item.totalAmount | currency:'INR'}}</td>
                      <td>{{item.siteAmount | currency:'INR'}}</td>
                    </tr>
                    </table>
                </div>
        
             <span class="action-icon">
             <a class="table-row-action edit-action" *ngIf="!editData " (click)="enableEditMethod($event,i)">
                <i class="fa fa-pencil" uib-tooltip="Edit" tooltip-trigger="mouseenter" tooltip-append-to-body="true" tooltip-placement="left"></i>
                
              </a>  &nbsp;   &nbsp;   &nbsp;
              <a *ngIf="!editData " (click)="delete(item)"><i class="fa fa-trash" uib-tooltip="delete" style="color:red;font-size: 20px;" tooltip-trigger="mouseenter" tooltip-append-to-body="true" tooltip-placement="left"></i></a>
              <i *ngIf="editData && enableEditIndex == i" style="color:red;font-size: 20px;" (click)="editData=false" class="fa fa-close" ng-click="cancel()"></i>
           &nbsp;   &nbsp;   &nbsp;   <i *ngIf="editData && enableEditIndex == i" style="color:green;font-size: 20px;" id="saveBtn" class="fa fa-check"  (click) = "saveData(item)" type="submit"></i>
            </span><br>
            <div class="row">
              <div class="col-sm-12 table ">
                <table id="customers">
                  <tr>
                    <th id="product">Product Item</th>
                  <th id="amt">Amount</th>
                  <th id="quant">Quantity</th>
       
                  </tr>
                  <tr *ngFor ="let data of item.expenses;">
                    <td >
                      <div id="product">
                        <input  type="text" class="itemclass" [(ngModel)]="data.productItem"  [disabled]="!editData">
                      </div>
                      </td>
                    <td> <input type="number" [(ngModel)]="data.amount" (blur)="onBlurEvent(item,i)" [disabled]="!editData"></td>
                    <td><input type="text" class="number1 quantityclass" [(ngModel)]="data.quantity"  [disabled]="!editData"></td>
                    
                   
                       </tr>
          
                 
                </table>
              </div>
             
              </div>
              <div class="botom-icon"> <span (click)="addRow(i,item)"><i class="fa fa-plus" aria-hidden="true"></i></span></div>
              <!-- &nbsp;&nbsp;&nbsp;<span (click)=" remove(i,item)"><i class="fa fa-minus" aria-hidden="true"></i></span> -->
              <br></div>
          </div>
          </nb-tab>
          <nb-tab tabTitle="Material Out Site">
           
            <div id="htmlDataMOutS">
              <h4 style="text-align: center;color:rgb(23, 23, 96)">{{siteNameValueheader}}-{{siteLocationNameheader}} Material Out Site</h4>
              <div class="transactHeading">Total Transaction On Site :<b>{{transactionobj?.MOutSExpense | currency:'INR'}}</b></div>
              <div *ngFor ="let item of  amountAfterChange;index as i" >
                
                <div class="row">
                  <div class="col-sm-12">
                    <span class="duration-class"><b>Duration:</b>&nbsp;{{item.date|date}}&nbsp;&nbsp; <i style="font-size:18px" (click) = "updateCalednder($event,i)" *ngIf="calenderHide" class="fa">&#xf073;</i> &nbsp;&nbsp;&nbsp;<input type="date" *ngIf="!calenderHide && enableCalenderIndex == i" [(ngModel)]="calender" (change)="handler(item)"> &nbsp;<span><i *ngIf="!calenderHide && enableCalenderIndex == i" style="color:red;" (click)="cancelCalender()" class="fa fa-close" ></i></span> </span>
                  </div>
                  <div class="col-sm-12">
                    <span class="duration-class"><b>SuperVisor : </b>{{item.superVisorName}}</span>
             
                  </div>
                </div>
                <div class="expenses-grid">
                  <table>
                    <tr>
                      <th>Total Expenses:</th>
                      <th>Recieving Amount:</th>
                      <th>Site Amount:</th>
                    </tr>
                    <tr>
                      <td>{{item.expenseAmount | currency:'INR'}}</td>
                      <td>{{item.totalAmount | currency:'INR'}}</td>
                      <td>{{item.siteAmount | currency:'INR'}}</td>
                    </tr>
                    </table>
                </div>
             
                
                <span class="action-icon">
             <a class="table-row-action edit-action" *ngIf="!editData " (click)="enableEditMethod($event,i)">
                <i class="fa fa-pencil" uib-tooltip="Edit" tooltip-trigger="mouseenter" tooltip-append-to-body="true" tooltip-placement="left"></i>
                
              </a>  &nbsp;   &nbsp;   &nbsp;
              <a *ngIf="!editData " (click)="delete(item)"><i class="fa fa-trash" uib-tooltip="delete" style="color:red;font-size: 20px;" tooltip-trigger="mouseenter" tooltip-append-to-body="true" tooltip-placement="left"></i></a>
              <i *ngIf="editData && enableEditIndex == i" style="color:red;font-size: 20px;" (click)="editData=false" class="fa fa-close" ng-click="cancel()"></i>
           &nbsp;   &nbsp;   &nbsp;  <a  *ngIf="editData && enableEditIndex == i" (click)= "saveData(item)"> <i style="color:green;font-size: 20px;" id="saveBtn" class="fa fa-check" type="submit"></i></a>
            </span><br>
            <div class="row">
              <div class="col-sm-12 table ">
                <table id="customers">
                  <tr>
                    <th id="product">Product Item</th>
                    <th id="amt">Amount</th>
                    <th id="quant">Quantity</th>
       
                  </tr>
                  <tr *ngFor ="let data of item.expenses;">
                    <td><input type="text"  class="itemclass" [(ngModel)]="data.productItem"  [disabled]="!editData"></td>
                    <td> <input type="number" [(ngModel)]="data.amount" (blur)="onBlurEvent(item,i)" [disabled]="!editData"></td>
                    <td><input type="text"  class="quantityclass" [(ngModel)]="data.quantity"  [disabled]="!editData"></td>
                    
                   
                       </tr>
          
                 
                </table>
              </div>
             
              </div>
              <div class="botom-icon"> <span (click)=" addRow(i,item)"><i class="fa fa-plus" aria-hidden="true"></i></span></div>
              <!-- <span (click)=" remove(i,item)"><i class="fa fa-minus" aria-hidden="true"></i></span> -->
           <br> </div>
          </div>
          </nb-tab>
        </nb-tabset>
    
      </nb-card-body>
      <nb-card-footer>
        <button styleSheetFile = "assets/css/print.css" printTitle="Expenses" printSectionId="htmlDataDE" class="btn btn-warning" ngxPrint>print</button>


      
      </nb-card-footer>
    </nb-card>

  
 